<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="Ethan Holder">
		<title>Music Scoring</title>

		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-responsive.min.css" rel="stylesheet">

		<script src="js/ie-emulation-modes-warning.js"></script>

		<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
		<script src="js/ie10-viewport-bug-workaround.js"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<style type="text/css"></style>
		<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
		<script src="js/bootstrap.min.js"></script>

		<link href="css/jquery.dataTables.min.css" rel="stylesheet">
		<script src="js/jquery.dataTables.min.js"></script>
	</head>
	<body>
		<script>
			var complexityOutput;
			$(document).on('ready', function(){
				$.ajax({
					context: this,
					dataType : "html",
					url : "navbar.htm",
					success : function(results) {
						$('#navholder').html(results);
					}
				});
				updateActiveListener();
			});
			$(document).on('click', '#ComplexityRunner', function () {
				var fileName = getRealMusicPieceName();
				//Need some code here to execute the jar file with the specified parameters.
				$.ajax({
					type : "POST",
					url : "backend.php",
					data : {xmlName:fileName},
					success : function(results) {
						complexityOutput = $.parseJSON(results);
						$('#resultholder').html( '<table cellpadding="0" cellspacing="0" border="0" class="display" id="retrievedData"></table>' );
						
						var table = $('#retrievedData').DataTable({
					        "columns": [
					            { "title": "Instrument Name" },
					            { "title": "Score" },
					            { "title": "Toughest Measure Number" },
					            { "title": "Toughest Measure Score" },
					            { "title": "Note Score" },
					            { "title": "Interval Score" }
					        ]
					    } );

						var i = 0;
					    for (; i < complexityOutput.length; i++) {
					    	var item = complexityOutput[i];
					    	table.row.add( [
					            item.partName,
					            item.overallScore,
					            item.worstMeasureNumber,
					            item.worstMeasureValue,
					            item.noteTotal,
					            item.intervalTotal
					        ] ).draw();
					    }


						//$('#resultholder').text(results);
					},
					error : function(something) {
						alert("There was a problem. Please try again or contact the Music Scoring team.");
					}
				});
			});
			$(function() {
				$(".musicpiece").click(function() {
			    	// remove classes from all
			    	$(".musicpiece").removeClass("active");
			    	// add class to the one we clicked
			    	$(this).addClass("active");
			    	updateActiveListener();
				});
			});

			function updateActiveListener() {
				$("#selectedholder").text(getActiveMusicPiece());				
			}

			function getActiveMusicPiece() {
				return $(".musicpiece.active").children()[0].text;
			}

			function getRealMusicPieceName() {
				var htmlName = getActiveMusicPiece();
				var toReturn = "MusicXMLs/";
				switch(htmlName) {
					case 'The Hobbit for Clarinet' :
						toReturn += "The_Hobbit_The_Desolation_of_Smaug_Medley_for_Solo_Clarinet.xml";
						break;
					case 'C Major Scale' :
						toReturn += "CMajorKey.xml";
						break;
					case 'Actor Prelude' :
						toReturn += "ActorPreludeSample.xml";
						break;
					default :
						toReturn += "The_Hobbit_The_Desolation_of_Smaug_Medley_for_Solo_Clarinet.xml";
						break;
				}

				return toReturn;
			}
		</script>
		
		<div id="navholder"></div>
		<div class="jumbotron">
			<h1>Music Scoring</h1>
		  	<p><div class="dropdown">
				<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
					Select a Piece to Score
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
					<li role="presentation" id="hobbit" class="musicpiece active"><a role="menuitem" tabindex="-1" href="#">The Hobbit for Clarinet</a></li>
					<li role="presentation" id="cmajor" class="musicpiece"><a role="menuitem" tabindex="-1" href="#">C Major Scale</a></li>
					<li role="presentation" id="actorprelude" class="musicpiece"><a role="menuitem" tabindex="-1" href="#">Actor Prelude</a></li>
				</ul>
			</div></p>
			<p>Selected Piece: <div id="selectedholder">
				...		
			</div></p>
			<p>Output: <div id="resultholder">...</div></p>
			<button type="button" id="ComplexityRunner" class="btn btn-primary">Run Backend Code</button>
		</div>
		
		<script src="js/docs.min.js"/>
	</body>
</html>